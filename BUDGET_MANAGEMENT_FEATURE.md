# 智能预算管理功能说明

## 功能概述

智能预算管理功能帮助用户合理规划和控制支出，通过设置预算目标、实时监控执行情况、智能预警提醒，实现科学的财务管理。

---

## 核心功能模块

### 1. 总体预算概览

#### 功能描述
在页面顶部显示整体预算执行情况的快速概览卡片。

#### 显示内容
- **总预算金额**：当前周期内所有分类预算的总和
- **已使用金额**：实际支出的总金额
- **剩余金额**：总预算 - 已使用金额
- **使用比例**：已使用金额 / 总预算金额 × 100%

#### 视觉设计
```
┌─────────────────────────────────┐
│  本月预算概览                    │
├─────────────────────────────────┤
│  总预算      已使用      剩余    │
│  ¥5000      ¥3200      ¥1800   │
│                                 │
│  ████████░░░░░░░░░░  64%       │
│                                 │
│  状态：正常使用中 ✓             │
└─────────────────────────────────┘
```

#### 状态标识
- 🟢 **正常**：使用率 < 80%（绿色）
- 🟡 **警告**：使用率 80% - 100%（黄色）
- 🔴 **超支**：使用率 > 100%（红色）

---

### 2. 分类预算管理

#### 功能描述
为每个消费类别设置独立的预算目标，支持灵活的周期设置。

#### 预算设置
- **选择分类**：从现有消费分类中选择（食物、交通、娱乐等）
- **设置金额**：输入该分类的预算金额
- **选择周期**：
  - 周预算：每周重置
  - 月预算：每月重置
  - 年预算：每年重置

#### 操作功能
- ➕ **添加预算**：为新分类设置预算
- ✏️ **编辑预算**：修改已有预算的金额或周期
- 🗑️ **删除预算**：移除不需要的预算设置
- 🔄 **批量设置**：快速为多个分类设置相同周期的预算

#### 界面示例
```
┌─────────────────────────────────┐
│  分类预算设置                    │
├─────────────────────────────────┤
│  🍔 食物                         │
│  预算：¥1500  周期：月          │
│  [编辑] [删除]                  │
├─────────────────────────────────┤
│  🚗 交通                         │
│  预算：¥800   周期：月          │
│  [编辑] [删除]                  │
├─────────────────────────────────┤
│  [+ 添加新预算]                 │
└─────────────────────────────────┘
```

---

### 3. 预算执行进度

#### 功能描述
实时显示各分类预算的使用情况，通过可视化进度条直观展示。

#### 显示内容
- **分类名称**：消费分类（带图标）
- **预算金额**：设定的预算目标
- **已使用金额**：当前周期内的实际支出
- **剩余金额**：预算 - 已使用
- **使用进度条**：可视化显示使用比例
- **使用百分比**：精确的使用率数值

#### 进度条颜色规则
- **绿色**（0% - 80%）：预算使用正常
- **黄色**（80% - 90%）：接近预算上限
- **橙色**（90% - 100%）：即将用完预算
- **红色**（> 100%）：预算已超支

#### 界面示例
```
┌─────────────────────────────────┐
│  🍔 食物                         │
│  ¥1200 / ¥1500                  │
│  ████████████░░░░  80%          │
│  剩余：¥300                      │
├─────────────────────────────────┤
│  🚗 交通                         │
│  ¥750 / ¥800                    │
│  ██████████████████  94% ⚠️     │
│  剩余：¥50                       │
├─────────────────────────────────┤
│  🎮 娱乐                         │
│  ¥650 / ¥500                    │
│  ████████████████████  130% 🔴  │
│  超支：¥150                      │
└─────────────────────────────────┘
```

---

### 4. 智能预警系统

#### 功能描述
自动监测预算使用情况，在关键节点发出预警提醒，帮助用户及时调整消费行为。

#### 预警类型

##### 4.1 接近预警（90%阈值）
- **触发条件**：预算使用率达到 90%
- **提醒内容**："【食物】预算即将用完，已使用90%（¥1350/¥1500），请注意控制支出"
- **显示位置**：
  - 预算页面顶部横幅
  - 首页通知提醒
  - 添加账单时弹窗提示

##### 4.2 超支警告（100%阈值）
- **触发条件**：预算使用率超过 100%
- **提醒内容**："【交通】预算已超支，超出¥50（¥850/¥800），建议减少该类支出"
- **显示位置**：
  - 预算页面醒目标识
  - 首页红色警告提示
  - 添加相关分类账单时强提醒

##### 4.3 周期提醒
- **触发条件**：预算周期即将结束（剩余3天）
- **提醒内容**："本月预算还剩3天，【食物】还有¥200可用，【娱乐】已超支¥150"
- **显示位置**：首页通知栏

##### 4.4 智能建议
- **触发条件**：根据历史数据分析
- **建议内容**：
  - "根据您的消费习惯，建议【食物】预算调整为¥1800"
  - "本月【娱乐】支出较上月增加50%，建议关注"
  - "您已连续3个月【交通】预算超支，建议调整预算或优化出行方式"

#### 预警设置
- **预警阈值**：可自定义（默认90%）
- **提醒方式**：
  - 页面内提示
  - 弹窗通知
  - 首页徽章提醒
- **免打扰模式**：可临时关闭预警

---

## 数据模型

### Budget（预算）
```typescript
{
  id: string;              // 唯一标识
  bookId: string;          // 所属账本ID
  category: string;        // 分类名称
  amount: number;          // 预算金额
  period: 'week' | 'month' | 'year';  // 预算周期
  startDate: string;       // 周期开始日期
  endDate: string;         // 周期结束日期
  warningThreshold: number; // 预警阈值（默认90）
  createTime: string;      // 创建时间
  updateTime: string;      // 更新时间
}
```

### BudgetProgress（预算执行情况）
```typescript
{
  budgetId: string;        // 预算ID
  category: string;        // 分类名称
  budgetAmount: number;    // 预算金额
  usedAmount: number;      // 已使用金额
  remainingAmount: number; // 剩余金额
  percentage: number;      // 使用百分比
  status: 'normal' | 'warning' | 'exceeded';  // 状态
  recordCount: number;     // 记录数量
}
```

---

## 技术实现

### 文件结构
```
entry/src/main/ets/
├── models/
│   └── Budget.ets                 # 预算数据模型
├── utils/
│   └── BudgetUtil.ets            # 预算管理工具类
├── pages/
│   └── BudgetPage.ets            # 预算管理页面
└── viewmodel/
    └── BudgetViewModel.ets       # 预算业务逻辑
```

### 核心功能

#### 1. 预算计算
```typescript
// 计算预算使用情况
calculateBudgetProgress(budget: Budget, records: AccountRecord[]): BudgetProgress {
  // 筛选当前周期内的记录
  const periodRecords = filterRecordsByPeriod(records, budget);
  
  // 计算已使用金额
  const usedAmount = periodRecords
    .filter(r => r.category === budget.category && r.type === 'expense')
    .reduce((sum, r) => sum + r.amount, 0);
  
  // 计算剩余金额和百分比
  const remainingAmount = budget.amount - usedAmount;
  const percentage = (usedAmount / budget.amount) * 100;
  
  // 判断状态
  const status = percentage > 100 ? 'exceeded' : 
                 percentage >= budget.warningThreshold ? 'warning' : 
                 'normal';
  
  return { budgetId, category, budgetAmount, usedAmount, remainingAmount, percentage, status };
}
```

#### 2. 预警检测
```typescript
// 检测预算预警
checkBudgetWarnings(budgets: Budget[], records: AccountRecord[]): Warning[] {
  const warnings: Warning[] = [];
  
  budgets.forEach(budget => {
    const progress = calculateBudgetProgress(budget, records);
    
    // 超支警告
    if (progress.status === 'exceeded') {
      warnings.push({
        type: 'exceeded',
        category: budget.category,
        message: `【${budget.category}】预算已超支`,
        severity: 'high'
      });
    }
    // 接近预警
    else if (progress.status === 'warning') {
      warnings.push({
        type: 'warning',
        category: budget.category,
        message: `【${budget.category}】预算即将用完`,
        severity: 'medium'
      });
    }
  });
  
  return warnings;
}
```

#### 3. 周期管理
```typescript
// 获取当前周期的开始和结束日期
getCurrentPeriod(period: 'week' | 'month' | 'year'): { start: Date, end: Date } {
  const now = new Date();
  
  switch (period) {
    case 'week':
      // 本周一到周日
      const dayOfWeek = now.getDay();
      const start = new Date(now);
      start.setDate(now.getDate() - (dayOfWeek === 0 ? 6 : dayOfWeek - 1));
      const end = new Date(start);
      end.setDate(start.getDate() + 6);
      return { start, end };
      
    case 'month':
      // 本月1号到最后一天
      return {
        start: new Date(now.getFullYear(), now.getMonth(), 1),
        end: new Date(now.getFullYear(), now.getMonth() + 1, 0)
      };
      
    case 'year':
      // 本年1月1日到12月31日
      return {
        start: new Date(now.getFullYear(), 0, 1),
        end: new Date(now.getFullYear(), 11, 31)
      };
  }
}
```

---

## 用户界面

### 页面布局
```
┌─────────────────────────────────┐
│  ← 预算管理              + ⋮    │  导航栏
├─────────────────────────────────┤
│  📊 本月预算概览                 │  总体概览
│  总预算 ¥5000  已用 ¥3200       │
│  ████████████░░░░░░  64%        │
├─────────────────────────────────┤
│  ⚠️ 预警提醒                     │  预警横幅
│  【交通】预算即将用完 (94%)      │
├─────────────────────────────────┤
│  🍔 食物  ¥1200/¥1500           │  分类进度
│  ████████████░░░░  80%          │
│  剩余：¥300                      │
├─────────────────────────────────┤
│  🚗 交通  ¥750/¥800             │
│  ██████████████████  94% ⚠️     │
│  剩余：¥50                       │
├─────────────────────────────────┤
│  🎮 娱乐  ¥650/¥500             │
│  ████████████████████  130% 🔴  │
│  超支：¥150                      │
├─────────────────────────────────┤
│  [+ 添加新预算]                 │  操作按钮
└─────────────────────────────────┘
```

### 交互流程

#### 添加预算
1. 点击"添加新预算"按钮
2. 选择分类（从现有分类中选择）
3. 输入预算金额
4. 选择预算周期（周/月/年）
5. 设置预警阈值（可选，默认90%）
6. 点击"保存"

#### 编辑预算
1. 点击预算项的"编辑"按钮
2. 修改金额或周期
3. 点击"保存"

#### 查看详情
1. 点击预算项
2. 显示详细信息：
   - 预算设置
   - 使用明细（该分类的所有记录）
   - 历史趋势（过去几个周期的对比）
   - 智能建议

---

## 使用场景

### 场景1：月初设置预算
小明在每月1号设置本月预算：
- 食物：¥1500
- 交通：¥800
- 娱乐：¥500
- 购物：¥1000

系统自动计算总预算¥3800，并开始监控。

### 场景2：日常消费监控
小明每次添加账单后：
- 系统自动更新对应分类的预算使用情况
- 实时显示剩余金额和使用百分比
- 当某分类达到90%时，弹窗提醒

### 场景3：预算超支提醒
小明的娱乐支出达到¥550，超过预算¥500：
- 预算页面该分类显示红色
- 首页显示超支警告
- 下次添加娱乐类账单时，弹窗提示已超支

### 场景4：月末总结
月底最后3天：
- 系统发送周期提醒
- 显示各分类执行情况
- 提供下月预算调整建议

---

## 数据统计

### 预算执行报告
- **总体执行率**：本周期预算使用百分比
- **分类排行**：各分类使用率排序
- **超支分析**：超支分类及金额统计
- **节约排行**：剩余预算最多的分类

### 历史对比
- **环比分析**：与上个周期对比
- **同比分析**：与去年同期对比
- **趋势图表**：预算使用趋势折线图

---

## 智能功能

### 1. 自动预算建议
根据历史消费数据，智能推荐合理的预算金额：
- 分析过去3个月的平均支出
- 考虑季节性因素（如冬季取暖费增加）
- 识别异常支出并排除

### 2. 消费习惯分析
- **高频消费时段**：识别容易超支的时间段
- **消费模式**：周末vs工作日消费对比
- **冲动消费识别**：标识可能的非必要支出

### 3. 预算优化建议
- **预算重分配**：建议将剩余预算转移到超支分类
- **消费优化**：提供节省开支的具体建议
- **目标设定**：帮助设定合理的储蓄目标

---

## 与其他功能的集成

### 1. 与账本关联
- 每个账本独立的预算设置
- 切换账本时自动切换对应预算

### 2. 与统计页面联动
- 统计页面显示预算执行情况
- 点击可跳转到预算管理页面

### 3. 与首页集成
- 首页显示预算概览卡片
- 显示预警提醒徽章
- 快速跳转到预算管理

### 4. 添加账单时提醒
- 输入金额时实时显示剩余预算
- 超预算时弹窗提醒
- 提供"仍要添加"和"取消"选项

---

## 未来扩展

### 短期优化
- [ ] 预算模板（快速应用常用预算设置）
- [ ] 预算分享（与家人共享预算）
- [ ] 预算锁定（防止误修改）
- [ ] 预算备注（记录预算设置原因）

### 中期功能
- [ ] 智能预算调整（自动根据收入调整）
- [ ] 预算目标（设定储蓄目标）
- [ ] 预算挑战（游戏化激励）
- [ ] 预算报告导出（PDF/Excel）

### 长期规划
- [ ] AI预算顾问（个性化建议）
- [ ] 家庭预算管理（多人协作）
- [ ] 投资预算规划（理财建议）
- [ ] 债务管理（还款计划）

---

## 总结

智能预算管理功能通过科学的预算设置、实时的执行监控、智能的预警提醒，帮助用户：

1. **明确目标**：清晰的预算设置让消费有计划
2. **实时掌控**：随时了解预算执行情况
3. **及时调整**：预警提醒帮助避免超支
4. **持续优化**：数据分析支持更好的财务决策

这是一个完整的、智能的、用户友好的预算管理解决方案，将显著提升用户的财务管理能力和体验。
