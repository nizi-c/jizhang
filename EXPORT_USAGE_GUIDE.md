# CSV 导出功能使用指南

## 功能说明

记账应用支持将账单记录导出为 CSV 格式文件，文件保存在应用缓存目录中。

## 使用方法

### 1. 导出所有记录
1. 打开"流水"页面
2. 点击右上角的 📤 导出按钮
3. 等待提示"导出成功"

### 2. 导出筛选后的记录
1. 打开"流水"页面
2. 点击 🔍 按钮打开筛选面板
3. 设置筛选条件（类型、分类、金额、日期等）
4. 点击 📤 导出按钮
5. 只会导出符合筛选条件的记录

## 文件位置

导出的 CSV 文件保存在应用缓存目录：
```
/data/storage/el2/base/haps/entry/cache/账单记录_YYYYMMDD_HHMMSS.csv
```

## 文件格式

CSV 文件包含以下字段：
- **日期** - YYYY-MM-DD 格式
- **类型** - 收入或支出
- **分类** - 分类名称
- **金额** - 保留两位小数
- **描述** - 记录描述
- **心情** - 心情表情和文字

### 示例
```csv
日期,类型,分类,金额,描述,心情
2025-11-23,支出,食物,35.50,"午餐",😊满意
2025-11-23,支出,交通,12.00,"地铁",
2025-11-22,收入,工资,5000.00,"月薪",🎉惊喜
```

## 如何访问导出的文件

### 方法1：使用 ADB 命令（开发者）
```bash
# 连接设备
adb devices

# 拉取文件到电脑
adb pull /data/storage/el2/base/haps/entry/cache/账单记录_20251123_143025.csv ./
```

### 方法2：使用文件管理器（需要 root 权限）
1. 安装支持访问应用数据的文件管理器
2. 导航到应用缓存目录
3. 找到导出的 CSV 文件
4. 复制到公共存储区域

### 方法3：通过应用日志查看文件路径
1. 导出文件后，查看应用日志
2. 日志中会显示完整的文件路径
3. 使用 ADB 或其他工具访问该路径

## 用 Excel 打开

1. 将 CSV 文件传输到电脑
2. 使用 Excel 打开文件
3. 如果中文显示乱码：
   - 打开 Excel
   - 选择"数据" -> "从文本/CSV"
   - 选择文件
   - 设置文件原始格式为 "UTF-8"
   - 点击"加载"

## 注意事项

1. **文件位置**
   - 文件保存在应用缓存目录
   - 缓存目录可能会被系统清理
   - 建议及时备份重要数据

2. **文件格式**
   - 标准 CSV 格式
   - UTF-8 编码
   - 逗号分隔
   - 引号包裹含特殊字符的字段

3. **数据安全**
   - 导出的文件包含所有账单信息
   - 请妥善保管导出的文件
   - 不要分享给不信任的人

4. **性能考虑**
   - 大量数据导出可能需要几秒钟
   - 导出过程中请勿关闭应用
   - 导出完成后会显示记录数量

## 常见问题

### Q: 为什么找不到导出的文件？
A: 文件保存在应用缓存目录，普通用户无法直接访问。需要使用 ADB 命令或 root 权限的文件管理器。

### Q: 可以导出到 SD 卡或公共目录吗？
A: 当前版本将文件保存在应用缓存目录。如需保存到公共目录，需要申请存储权限。

### Q: CSV 文件用 Excel 打开乱码怎么办？
A: 使用 Excel 的"从文本/CSV"功能导入，并设置编码为 UTF-8。

### Q: 可以导出为其他格式吗？
A: 当前只支持 CSV 格式。CSV 是通用格式，可以被 Excel、Google Sheets 等工具打开。

### Q: 导出的文件会占用很多空间吗？
A: CSV 是文本格式，占用空间很小。1000 条记录大约只有 100KB。

## 开发者信息

### 导出流程
1. 生成 CSV 内容（ExportUtil.exportToCSV）
2. 生成文件名（ExportUtil.generateFileName）
3. 保存到缓存目录（ExportUtil.saveCSVFile）
4. 显示成功提示

### 文件命名规则
```
账单记录_YYYYMMDD_HHMMSS.csv
```
例如：`账单记录_20251123_143025.csv`

### 技术实现
- 使用 `@ohos.file.fs` 进行文件操作
- 使用 `context.cacheDir` 获取缓存目录
- CSV 格式符合 RFC 4180 标准
- 特殊字符正确转义

## 未来改进计划

1. **公共目录保存**
   - 申请存储权限
   - 保存到 Documents 或 Downloads 目录
   - 用户可直接访问

2. **系统分享功能**
   - 集成系统分享面板
   - 支持分享到邮件、云盘等
   - 支持保存到文件管理器

3. **更多导出格式**
   - Excel (.xlsx)
   - JSON
   - PDF 报表

4. **云端备份**
   - 自动备份到云端
   - 多设备同步
   - 版本管理

## 总结

当前的 CSV 导出功能可以将账单数据导出为标准格式，虽然文件保存在应用缓存目录，但开发者可以通过 ADB 命令轻松访问。对于普通用户，建议在后续版本中添加保存到公共目录或系统分享的功能。
