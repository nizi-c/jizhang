# 文件管理器访问导出文件

## 功能说明

导出的CSV文件现在可以直接在文件管理器中访问！

## 使用步骤

### 1. 首次导出
1. 打开"流水"页面
2. 点击右上角 📤 导出按钮
3. 系统弹出权限请求对话框
4. 点击"允许"授予存储权限
5. 文件自动保存到下载目录

### 2. 查看导出的文件
1. 打开系统文件管理器
2. 进入"下载"或"Download"文件夹
3. 找到以"账单记录_"开头的CSV文件
4. 点击文件即可打开或分享

## 文件位置

### 有存储权限（推荐）
文件保存在系统下载目录，可以直接访问：
- 文件管理器 -> 下载
- 文件管理器 -> Download
- 文件管理器 -> 最近文件

### 无存储权限
文件保存在应用缓存目录，需要ADB命令访问：
```bash
adb pull /data/storage/el2/base/haps/entry/cache/账单记录_*.csv ./
```

## 文件操作

### 打开文件
1. 在文件管理器中找到CSV文件
2. 点击文件
3. 选择用什么应用打开：
   - WPS Office
   - Microsoft Excel
   - Google Sheets
   - 其他表格应用

### 分享文件
1. 长按CSV文件
2. 选择"分享"
3. 选择分享方式：
   - 邮件
   - 微信
   - QQ
   - 云盘
   - 蓝牙

### 复制文件
1. 长按CSV文件
2. 选择"复制"
3. 导航到目标文件夹
4. 粘贴文件

### 删除文件
1. 长按CSV文件
2. 选择"删除"
3. 确认删除

## 在电脑上访问

### 方法1：USB连接
1. 使用USB线连接手机和电脑
2. 手机上选择"文件传输"模式
3. 在电脑上打开手机存储
4. 进入"Download"文件夹
5. 找到CSV文件并复制到电脑

### 方法2：云盘同步
1. 将CSV文件上传到云盘（如百度网盘、OneDrive）
2. 在电脑上打开云盘
3. 下载CSV文件

### 方法3：邮件发送
1. 在文件管理器中分享CSV文件
2. 选择邮件应用
3. 发送到自己的邮箱
4. 在电脑上打开邮箱下载附件

## 用Excel打开

### 在手机上
1. 安装WPS Office或Microsoft Excel
2. 在文件管理器中点击CSV文件
3. 选择Excel应用打开
4. 查看和编辑数据

### 在电脑上
1. 将文件传输到电脑
2. 双击CSV文件
3. Excel自动打开
4. 如果中文乱码：
   - 打开Excel
   - 数据 -> 从文本/CSV
   - 选择文件
   - 文件原始格式：UTF-8
   - 点击加载

## 权限说明

### 为什么需要存储权限？
- 将文件保存到公共下载目录
- 让文件管理器可以访问
- 方便用户查看和分享

### 如何授予权限？
1. 首次导出时会自动请求
2. 点击"允许"即可
3. 或在系统设置中手动授予

### 如何撤销权限？
1. 打开系统设置
2. 应用管理 -> 记账应用
3. 权限 -> 存储
4. 关闭权限

## 导出提示说明

### 有权限时
```
导出成功！共50条记录
文件：账单记录_20251123_143025.csv

已保存到下载目录
可在文件管理器中查看
```

### 无权限时
```
导出成功！共50条记录
文件：账单记录_20251123_143025.csv

提示：授予存储权限可保存到下载目录
```

## 常见问题

### Q: 在文件管理器中找不到文件？
A: 
1. 确认已授予存储权限
2. 检查"下载"或"Download"文件夹
3. 尝试搜索"账单记录"
4. 查看"最近文件"

### Q: 文件打开后是乱码？
A: 
1. 使用支持UTF-8的应用打开
2. 在Excel中使用"从文本/CSV"导入
3. 选择UTF-8编码

### Q: 可以修改导出的文件吗？
A: 
可以，但修改后的文件不会同步回应用。
建议只用于查看和分析，不要修改原始数据。

### Q: 导出的文件会占用很多空间吗？
A: 
不会。CSV是文本格式，非常小：
- 100条记录 ≈ 10KB
- 1000条记录 ≈ 100KB
- 10000条记录 ≈ 1MB

### Q: 可以导出到SD卡吗？
A: 
当前版本保存到内部存储的下载目录。
如需保存到SD卡，可以在文件管理器中手动移动文件。

## 技术实现

### 使用Environment API
```typescript
import { Environment } from '@kit.AbilityKit';

// 获取用户下载目录
const documentsDir = Environment.getUserDownloadDir();
const filePath = `${documentsDir}/${fileName}`;
```

### 权限请求
```typescript
// 请求存储权限
const hasPermission = await PermissionUtil.requestStoragePermissions(context);

if (hasPermission) {
  // 保存到公共下载目录
  filePath = await ExportUtil.saveToPublicDirectory(csvContent, fileName, context);
} else {
  // 降级到缓存目录
  filePath = await ExportUtil.saveCSVFile(csvContent, fileName, context);
}
```

### 降级方案
如果保存到公共目录失败，会自动降级到应用缓存目录，确保导出功能始终可用。

## 优势

✅ **用户友好**
- 直接在文件管理器中访问
- 不需要ADB命令
- 不需要root权限

✅ **方便分享**
- 可以直接分享给其他应用
- 可以上传到云盘
- 可以通过邮件发送

✅ **易于备份**
- 可以复制到其他位置
- 可以传输到电脑
- 可以保存到SD卡

✅ **兼容性好**
- 标准CSV格式
- 可用Excel打开
- 可用Google Sheets打开
- 可用任何表格应用打开

## 总结

通过使用Environment API获取公共下载目录，导出的CSV文件现在可以直接在文件管理器中访问，大大提升了用户体验！

用户只需：
1. 授予存储权限（首次）
2. 点击导出按钮
3. 在文件管理器中查看文件

简单、直观、方便！
