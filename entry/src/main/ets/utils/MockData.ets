import { AccountRecord } from '../models/AccountRecord';
import { StorageUtil } from './StorageUtil';

interface CategoryInfo {
  name: string;
  descriptions: string[];
}

interface IncomeCategoryInfo {
  name: string;
  amount: number[];
}

export class MockData {
  // ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
  static async generateMockData(): Promise<void> {
    const mockRecords: AccountRecord[] = [];
    const today = new Date();
    
    // ç”Ÿæˆæœ€è¿‘30å¤©çš„æ•°æ®
    for (let i = 0; i < 30; i++) {
      const date = new Date(today);
      date.setDate(date.getDate() - i);
      const dateStr = MockData.formatDate(date);
      
      // æ¯å¤©ç”Ÿæˆ2-5æ¡è®°å½•
      const recordCount = Math.floor(Math.random() * 4) + 2;
      
      for (let j = 0; j < recordCount; j++) {
        const isExpense = Math.random() > 0.3; // 70%æ¦‚ç‡æ˜¯æ”¯å‡º
        
        if (isExpense) {
          mockRecords.push(MockData.generateExpenseRecord(dateStr));
        } else {
          mockRecords.push(MockData.generateIncomeRecord(dateStr));
        }
      }
    }
    
    // ä¿å­˜åˆ°å­˜å‚¨
    await StorageUtil.saveRecords(mockRecords);
  }
  
  // ç”Ÿæˆæ”¯å‡ºè®°å½•
  private static generateExpenseRecord(dateStr: string): AccountRecord {
    const categories: CategoryInfo[] = [
      { name: 'é£Ÿç‰©', descriptions: ['æ—©é¤', 'åˆé¤', 'æ™šé¤', 'é›¶é£Ÿ', 'æ°´æœ', 'é¥®æ–™'] },
      { name: 'äº¤é€š', descriptions: ['åœ°é“', 'å…¬äº¤', 'æ‰“è½¦', 'åŠ æ²¹', 'åœè½¦è´¹'] },
      { name: 'å¨±ä¹', descriptions: ['ç”µå½±', 'æ¸¸æˆ', 'KTV', 'æ—…æ¸¸', 'è¿åŠ¨'] },
      { name: 'è´­ç‰©', descriptions: ['è¡£æœ', 'é‹å­', 'åŒ–å¦†å“', 'æ—¥ç”¨å“', 'ç”µå­äº§å“'] },
      { name: 'åŒ»ç–—', descriptions: ['çœ‹ç—…', 'ä¹°è¯', 'ä½“æ£€', 'ä¿å¥å“'] },
      { name: 'æ•™è‚²', descriptions: ['ä¹¦ç±', 'è¯¾ç¨‹', 'åŸ¹è®­', 'å­¦è´¹'] },
      { name: 'ä½æˆ¿', descriptions: ['æˆ¿ç§Ÿ', 'æ°´ç”µè´¹', 'ç‰©ä¸šè´¹', 'ç½‘è´¹'] },
      { name: 'å…¶ä»–', descriptions: ['ç¤¼ç‰©', 'æèµ ', 'ç»´ä¿®', 'å…¶ä»–æ”¯å‡º'] }
    ];
    
    const category = categories[Math.floor(Math.random() * categories.length)];
    const description = category.descriptions[Math.floor(Math.random() * category.descriptions.length)];
    
    // æ ¹æ®åˆ†ç±»ç”Ÿæˆåˆç†çš„é‡‘é¢èŒƒå›´
    let amount = 0;
    switch (category.name) {
      case 'é£Ÿç‰©':
        amount = Math.random() * 80 + 10; // 10-90
        break;
      case 'äº¤é€š':
        amount = Math.random() * 50 + 5; // 5-55
        break;
      case 'å¨±ä¹':
        amount = Math.random() * 200 + 50; // 50-250
        break;
      case 'è´­ç‰©':
        amount = Math.random() * 500 + 100; // 100-600
        break;
      case 'åŒ»ç–—':
        amount = Math.random() * 300 + 50; // 50-350
        break;
      case 'æ•™è‚²':
        amount = Math.random() * 400 + 100; // 100-500
        break;
      case 'ä½æˆ¿':
        amount = Math.random() * 2000 + 1000; // 1000-3000
        break;
      default:
        amount = Math.random() * 200 + 20; // 20-220
    }
    
    const moods: string[] = ['ğŸ˜Šæ»¡æ„', 'ğŸ˜Ÿåæ‚”', 'ğŸ‰æƒŠå–œ'];
    const mood = moods[Math.floor(Math.random() * moods.length)];
    
    return {
      id: MockData.generateId(),
      type: 'expense',
      category: category.name,
      amount: Math.round(amount * 100) / 100,
      description: description,
      date: new Date(dateStr).getTime(),
      dateStr: dateStr,
      mood: mood
    };
  }
  
  // ç”Ÿæˆæ”¶å…¥è®°å½•
  private static generateIncomeRecord(dateStr: string): AccountRecord {
    const categories: IncomeCategoryInfo[] = [
      { name: 'å·¥èµ„', amount: [5000, 15000] },
      { name: 'å¥–é‡‘', amount: [1000, 5000] },
      { name: 'æŠ•èµ„', amount: [500, 3000] },
      { name: 'å…¼èŒ', amount: [500, 2000] },
      { name: 'å…¶ä»–', amount: [100, 1000] }
    ];
    
    const category = categories[Math.floor(Math.random() * categories.length)];
    const amount = Math.random() * (category.amount[1] - category.amount[0]) + category.amount[0];
    
    const moods: string[] = ['ğŸ˜Šæ»¡æ„', 'ğŸ‰æƒŠå–œ'];
    const mood = moods[Math.floor(Math.random() * moods.length)];
    
    return {
      id: MockData.generateId(),
      type: 'income',
      category: category.name,
      amount: Math.round(amount * 100) / 100,
      description: category.name,
      date: new Date(dateStr).getTime(),
      dateStr: dateStr,
      mood: mood
    };
  }
  
  // æ ¼å¼åŒ–æ—¥æœŸ
  private static formatDate(date: Date): string {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }
  
  // ç”ŸæˆID
  private static generateId(): string {
    return Date.now().toString() + Math.random().toString(36).substr(2, 9);
  }
  
  // æ¸…é™¤æ‰€æœ‰æ•°æ®
  static async clearAllData(): Promise<void> {
    await StorageUtil.saveRecords([]);
  }
}
